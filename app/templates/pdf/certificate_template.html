<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>No Dues Certificate</title>

{{ page_style|safe }}

<style>
/* =================== BASE SETTINGS =================== */
body {
    font-family: Helvetica, Arial, sans-serif;
    font-size: 11px;
    color: #1e293b;
    margin: 0;
    padding: 0;
    background: #ffffff;
}

/* =================== HEADER =================== */
.header {
    text-align: center;
    margin-bottom: 20px;
    border-bottom: 2px solid #e2e8f0;
    padding-bottom: 10px;
}
.header img {
    height: 60px;
    margin-bottom: 5px;
}
.university-name {
    font-size: 20px;
    font-weight: bold;
    text-transform: uppercase;
    color: #0f172a;
    padding-top: 5px;
}
.university-sub {
    font-size: 10px;
    color: #64748b;
    margin-bottom: 8px;
}
.doc-title {
    display: inline-block;
    padding: 6px 20px;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
    background-color: #e0f2fe;
    color: #0369a1;
    border: 1px solid #bae6fd;
    /* Note: border-radius is ignored by xhtml2pdf, but background works */
}

/* =================== SECTIONS =================== */
.section-title {
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
    color: #334155;
    border-bottom: 1px solid #cbd5e1;
    padding-bottom: 4px;
    margin-top: 20px;
    margin-bottom: 10px;
}

/* =================== TABLES =================== */
/* xhtml2pdf handles tables best for layout */
.profile-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
.profile-table td { width: 50%; padding: 4px 0; vertical-align: top; }

.label {
    font-size: 8px;
    text-transform: uppercase;
    color: #64748b;
    display: block;
}
.value {
    font-size: 11px;
    font-weight: bold;
    color: #0f172a;
    display: block;
    border-bottom: 1px solid #f1f5f9;
    padding-bottom: 2px;
    margin-bottom: 4px;
    margin-right: 15px;
}

/* Clearance Table */
.clearance-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 10px;
    border: 1px solid #e2e8f0;
}
.clearance-table th {
    background-color: #f1f5f9;
    color: #475569;
    font-weight: bold;
    text-transform: uppercase;
    padding: 6px;
    border-bottom: 1px solid #cbd5e1;
    text-align: left;
    font-size: 9px;
}
.clearance-table td {
    padding: 6px;
    border-bottom: 1px solid #e2e8f0;
    color: #334155;
}
/* Alternating rows for readability */
.clearance-table tr.even { background-color: #f8fafc; }

/* Status Badges - Simulated with Colors */
.status-approved { color: #166534; font-weight: bold; }
.status-pending { color: #854d0e; font-weight: bold; }

/* =================== SUMMARY =================== */
/* Converted to table for robust layout in PDF */
.summary-container {
    margin-top: 25px;
    background-color: #f8fafc;
    border: 1px solid #e2e8f0;
    padding: 15px;
}
.summary-layout { width: 100%; }
.summary-left { vertical-align: top; width: 70%; }
.summary-right { vertical-align: top; width: 30%; text-align: right; }

.cert-id {
    font-family: Courier, monospace;
    font-size: 14px;
    font-weight: bold;
    color: #0f172a;
}

/* =================== FOOTER =================== */
.footer {
    margin-top: 30px;
    text-align: center;
    font-size: 8px;
    color: #94a3b8;
    border-top: 1px dashed #e2e8f0;
    padding-top: 10px;
}
</style>
</head>

<body>

<div class="header">
    <img src="data:image/png;base64,{{ logo_base64 }}" alt="Logo" />
    <div class="university-name">Gautam Buddha University</div>
    <div class="university-sub">Greater Noida, Uttar Pradesh, India</div>
    <div class="doc-title">No Dues Certificate</div>
</div>

<div class="section-title">Student Profile</div>
<table class="profile-table">
    <tr>
        <td>
            <span class="label">Full Name</span>
            <span class="value">{{ student.full_name }}</span>
        </td>
        <td>
            <span class="label">Roll Number</span>
            <span class="value">{{ student.roll_number }}</span>
        </td>
    </tr>
    <tr>
        <td>
            <span class="label">Enrollment Number</span>
            <span class="value">{{ student.enrollment_number }}</span>
        </td>
        <td>
            <span class="label">Program / Admission Year</span>
            <span class="value">{{ student.admission_type or 'Regular' }} / {{ student.admission_year }}</span>
        </td>
    </tr>
    <tr>
        <td>
            <span class="label">Contact</span>
            <span class="value">{{ student.mobile_number }}</span>
        </td>
        <td>
            <span class="label">Email</span>
            <span class="value">{{ student.email }}</span>
        </td>
    </tr>
</table>

<div class="section-title">Clearance Status</div>
<table class="clearance-table">
    <thead>
        <tr>
            <th width="5%">#</th>
            <th width="40%">Department</th>
            <th width="20%">Status</th>
            <th width="20%">Verified By</th>
            <th width="15%">Date</th>
        </tr>
    </thead>
    <tbody>
    {% for stage in stages %}
        <tr class="{{ loop.cycle('', 'even') }}">
            <td>{{ loop.index }}</td>
            <td><strong>{{ stage.department_name }}</strong></td>
            <td>
                {% if stage.status == 'Approved' %}
                    <span class="status-approved">APPROVED</span>
                {% else %}
                    <span class="status-pending">{{ stage.status | upper }}</span>
                {% endif %}
            </td>
            <td>
                {% if stage.status == 'Approved' %}
                    {{ stage.reviewer_name }}<br>
                    <span style="font-size:8px; color:#94a3b8;">(Digital Sign)</span>
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ stage.reviewed_at }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<div class="summary-container">
    <table class="summary-layout">
        <tr>
            <td class="summary-left">
                <span class="label">Certificate ID</span>
                <div class="cert-id">{{ certificate_id }}</div>
                <br>
                <span class="label">Generated On</span>
                <div class="value" style="border:none;">{{ generation_date }}</div>
                
                <div style="margin-top:10px; color:#166534; font-weight:bold; font-size:11px;">
                    âœ” Final Status: Completed
                </div>
            </td>
            <td class="summary-right">
                <div style="border:1px solid #e2e8f0; padding:5px; background:#fff; display:inline-block;">
                    <img src="data:image/png;base64,{{ qr_base64 }}" width="80" height="80" alt="QR">
                </div>
                <div style="font-size:8px; color:#475569; margin-top:4px;">Scan to Verify</div>
            </td>
        </tr>
    </table>
</div>

<div class="footer">
    This is a computer-generated document and does not require a physical signature.<br>
    School of ICT, Gautam Buddha University
</div>

</body>
</html>